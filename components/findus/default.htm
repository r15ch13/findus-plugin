<div class="container">
	<div class="row">
	{% if __SELF__.map_template == 'map_only' %}
		{% partial __SELF__ ~ "::largemap" %}
	{% elseif __SELF__.map_template == 'map_info_right' %}
		<div class="col-xs-12 col-md-8 findus-left">
			{% partial __SELF__ ~ "::largemap" %}
		</div>
		<div class="col-xs-12 col-md-4 findus-right">
			<p>{{ __SELF__.location_title }}</p>
			<p>{{ __SELF__.address1 }}</p>
			<p>{{ __SELF__.city }}, {{ __SELF__.state_zip }}</p>
		</div>
	{% elseif __SELF__.map_template == 'info_small_map' %}
		{% partial __SELF__ ~ "::smallmap" %}
		<p>{{ __SELF__.location_title }}</p>
		<p>{{ __SELF__.address1 }}</p>
		<p>{{ __SELF__.city }}, {{ __SELF__.state_zip }}</p>
		{% partial __SELF__ ~ "::popup" %}
	{% elseif __SELF__.map_template == 'link_only' %}
		{% partial __SELF__ ~ "::popup" %}
	{% endif %}
	</div>
</div>

{% put scripts %}
<script>(window.google && window.google.maps) || document.write('<script src="//maps.google.com/maps/api/js?sensor=false"><\/script>')</script>
<script type="text/javascript">
// The Google Map
$(document).ready(function() {

	var findus = document.getElementsByClassName('findus-map');
	var maps = [];

	for (var i = 0; i < findus.length; i++)
	{
		(function(element, data) {

			if($(element).hasClass('findus-popup')) {
				$(element).hide();
			}

			// Set the map styles
			var stylers = [
				{ "gamma": 1.61 },
				{ "lightness": -7 },
				{ "hue": data.color },
			];

			if(data.color == 'black' || data.color == 'grey') {
				stylers.push({ "saturation": -100 });
			}
			if(data.color == '#ff6e00') {
				stylers.push({ "saturation": -64 });
			}
			if(data.color == 'black') {
				stylers.push({ "invert_lightness": true });
			}

			var myLatLng = new google.maps.LatLng(data.lat, data.lon);

			// Set the options to be used when creating the map
			var myOptions = {
				zoom: 0,
				center: myLatLng,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			};

			var infowindow = new google.maps.InfoWindow({
				content: '<p><strong>'+data.address+'</strong></p><p><a href="https://www.google.com/maps/preview?daddr='+data.lat+','+data.lon+'" target="_blank" style="color: black!important;">'+data.markertext+'</a><p>'
			});
			var mapL = new google.maps.Map(element, myOptions);

			// for later use with show-findus
			maps[$(element).attr('id')] = mapL;

			var marker = new google.maps.Marker({
				position: myLatLng,
				map: mapL,
				title: data.address,
				zIndex: 1
			});

			google.maps.event.addListener(marker, 'click', function() {
				infowindow.open(mapL, marker);
			});

			mapL.setOptions({styles: [
				{ "stylers": stylers }
			]});

			// Create a new latlng based on the latitude and longitude from the user's position
			mapL.setCenter(myLatLng);
			mapL.setZoom(12);
			google.maps.event.trigger(mapL, "resize");

		})(findus[i], findus[i].dataset);
	};

	$('.show-findus').each(function(){
		$(this).fancybox({
			afterShow: function(){
				var mapL = maps[$(this).attr('href').substr(1)];
				if(mapL) {
					var currCenter = mapL.getCenter();
					google.maps.event.trigger(mapL, "resize");
					mapL.setCenter(currCenter);
				}
			},
		});
	});

});
</script>
{% endput %}